<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Bin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
</head>

<body onload="atualizarFeed()">
    <div class="content">
        <div class="menu">
            <h3>Bairros</h3>
            <ul class="menu_list">
                <a href="tela_dashboard.html">
                    <li>Todos os bairros</li>
                </a>
                <a href="boa_vista.html">
                    <li>Boa Vista</li>
                </a>
                <a href="jardim_paulista.html">
                    <li>Jardim Paulista</li>
                </a>
                <a href="jabaquara.html">
                    <li>Jabaquara</li>
                </a>
                <a href="santa_cecilia.html">
                    <li>Santa Cecília</li>
                </a>
                <a href="santo_amaro.html">
                    <li>Santo Amaro</li>
                </a>
            </ul>
            <h3>Configurações</h3>
            <ul class="menu_list">
                <div id="div_links">
                    
                </div>
                <a href="Visualizacao_perfil.html">
                    <li>Usuário</li>
                </a>
            </ul>

            <a class="logOut" href="index.html">Sair <img src="../img/logOut.png" alt=""></a>

            <div id="usuario" class="foto_user_box">
                <!-- <a href="Visualizacao_perfil.html"><img src="../img/perfil.png" alt=""></a>  -->
                
            </div>
        </div>
        <div class="conteudo">
            <h1>Todos os bairros</h1>
            <img class="logo" src="img/logo_smartBin-removebg-preview.png" alt="">

            <div class="box_dados">
                <div>
                    <h3>Lixeira Nivel <span style="color: #297011;">Baixo</span> </h3>
                    <p>2</p>
                </div>
                <div>
                    <h3>Lixeira Nivel <span style="color: #d1ce00;">Médio</span></h3>
                    <p>2</p>
                </div>

                <div>
                    <h3>Lixeira Nível <span style="color: red;">Alto</span></h3>
                    <p>6</p>
                </div>
            </div>
            <div class="cards_grid" id="card_pai">
                <!-- <div id="card" class="card">

                    <a href="tela_historico.html">

                    <h3>Lixeira 1</h3> </a>
                    </a>
                    <i id="lixeira" style="color: red;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: Consolação, 101, Boa vista</h4>
                    <h4>Nível: <span style="color: red;">Alto</span></h4>
                </div>
                <div class="card">

                    <h3>Lixeira 2</h3>
                    <i style="color: red;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: bento alves, 544, Jabaquara</h4>
                    <h4>Nível: <span style="color: red;">Alto</span></h4>
                </div>


                <div class="card">

                    <h3>Lixeira 5</h3>
                    <i style="color: red;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: Domingos, 54, Santo Amaro</h4>
                    <h4>Nível: <span style="color: red;">Alto</span></h4>
                </div>

                <div class="card">

                    <h3>Lixeira 6</h3>
                    <i style="color: red;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: carlos de campos, 105, Boa vista</h4>
                    <h4>Nível: <span style="color: red;">Alto</span></h4>
                </div>

                <div class="card">

                    <h3>Lixeira 7</h3>
                    <i style="color: red;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: Haiti 32, Jardim paulista</h4>
                    <h4>Nível: <span style="color: red;">Alto</span></h4>
                </div>
                <div class="card">

                    <h3>Lixeira 10</h3>
                    <i style="color: red;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: santinho freitas, 5487, Santo Amaro</h4>
                    <h4>Nível: <span style="color: red;">Alto</span></h4>
                </div>
                <div class="card">
                    <h3>Lixeira 4</h3>
                    <i style="color: #d1ce00;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: santos drummond, 1047, Santa Cecília</h4>
                    <h4>Nível: <span style="color: #d1ce00;">Medio</span></h4>
                </div>

                <div class="card">

                    <h3>Lixeira 9</h3>
                    <i style="color: #d1ce00;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: Alameda franca, 1047, Jardim paulista </h4>
                    <h4>Nível: <span style="color: #d1ce00;">Medio</span></h4>
                </div>

                <div class="card">
                    <h3>Lixeira 3</h3>
                    <i style="color: #297011;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: owald melo, 2584, Boa Vista</h4>
                    <h4>Nível: <span style="color: #297011;">Baixo</span></h4>
                </div>
                <div class="card">

                    <h3>Lixeira 8</h3>
                    <i style="color: #297011;" class="fa-solid fa-dumpster"></i>
                    <h4>Rua: Freire farto, 254, Jabaquara</h4>
                    <h4>Nível: <span style="color: #297011;">Baixo</span></h4>
                </div> -->
            </div>

            <h1 class="titulo_grafico">Gráfico:</h1>
            <div class="grafico_box">
                <select id="select_semana">
                    <option value="1">Essa semana</option>
                    <option value="2">Semana - 29/04/2024 até 05/05/2024</option>
                    <option value="3">Semana - 22/04/2024 até 28/04/2024</option>
                    <option value="4">Semana - 15/04/2024 até 21/04/2024</option>
                    <option value="5">Semana - 08/04/2024 até 14/04/2024</option>
                    <option value="6">Semana - 01/04/2024 até 07/04/2024</option>
                </select>
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>
</body>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="area_edit">
            <h3>Lixeira 1</h3>
            <a href="#" id="EditModal"><i class="fa-solid fa-pen"></i></a>
        </div>
        <!-- <i class="fa-solid fa-pen"></i> -->


        <i style="color: red;" class="fa-solid fa-dumpster"></i>
        <h4>Rua: Consolação, 101, Boa vista</h4>
        <h4>Nível: <span style="color: red;">Alto</span></h4>
        <h3>Horarios</h3>
        <div>
            <h5>Nivel: Médio - 09:45:58 do dia 03/04/24 até 15:44:08 do dia 03/04/24</h5>
            <h5>Nivel: Alto - 15:44:08 do dia 03/04/24 até 20:22:19 do dia 03/04/24</h5>
        </div>
        <div class="btn btn_historico">
            <a href="#" id="openModal">
                <button class="botao">Informações</button>
            </a>
        </div>
    </div>
</div>

<div id="ModalEdicao" class="modal">
    <div class="modal-content">
        <span class="closeEdit">&times;</span>
        <h3 contenteditable="true">Lixeira 1</h3>
        <i style="color: red;" class="fa-solid fa-dumpster"></i>
        <h4 contenteditable="true">Rua: Consolação, 101, Boa vista</h4>
        <h4>Nível: <span style="color: red;">Alto</span></h4>
        <h3>Horarios</h3>
        <div>
            <h5>Nivel: Médio - 09:45:58 do dia 03/04/24 até 15:44:08 do dia 03/04/24</h5>
            <h5>Nivel: Alto - 15:44:08 do dia 03/04/24 até 20:22:19 do dia 03/04/24</h5>

        </div>
        <div class="btn">
            <button class="botao" id="saveButton">salvar</button>
        </div>
    </div>
</div>

</html>

<script>


    document.getElementById('openModal').addEventListener('click', function () {
        document.getElementById('modal').style.display = 'block';
        document.querySelector('.conteudo').style.display = 'none'; // Oculta a div conteudo
    });

    document.querySelector('.close').addEventListener('click', function () {
        document.getElementById('modal').style.display = 'none';
        document.querySelector('.conteudo').style.display = 'block'; // Mostra a div conteudo novamente
    });

    document.getElementById('EditModal').addEventListener('click', function () {
        document.getElementById('ModalEdicao').style.display = 'block';
        document.querySelector('.openModal').style.display = 'none'; // Oculta a div conteudo
    });

    document.querySelector('.closeEdit').addEventListener('click', function () {
        document.getElementById('ModalEdicao').style.display = 'none';
        document.querySelector('.openModal').style.display = 'block'; // Mostra a div conteudo novamente
    });

    // Adiciona um evento de clique ao botão "Salvar" no modal de edição
    document.getElementById('saveButton').addEventListener('click', function () {
        // Obtém o conteúdo modificado da div ModalEdicao
        var novoTitulo = document.getElementById('ModalEdicao').querySelector('h3').innerText;
        var novaRua = document.getElementById('ModalEdicao').querySelector('h4').innerText;

        // Atualiza o conteúdo correspondente na div modal
        document.getElementById('modal').querySelector('h3').innerText = novoTitulo;
        document.getElementById('modal').querySelector('h4').innerText = novaRua;

        document.getElementById('card').querySelector('h3').innerText = novoTitulo;
        document.getElementById('card').querySelector('h4').innerText = novaRua;

        // Esconde o modal de edição
        document.getElementById('ModalEdicao').style.display = 'none';
    });

    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
            datasets: [{
                label: 'Lixeira nivel médio',
                data: [1, 3, 2, 4, 1, 0, 1],
                borderWidth: 1,
                backgroundColor: 'yellow'
            },
            {
                label: 'Lixeira nivel alto',
                data: [5, 2, 4, 1, 2, 6, 4],
                borderWidth: 1,
                backgroundColor: 'red'
            },
            {
                label: 'Lixeira nivel baixo',
                data: [4, 5, 4, 5, 7, 4, 5],
                borderWidth: 1,
                backgroundColor: 'green'
            }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Quantidade de lixeiras'
                    }
                }
            },

        }
    });

    function atualizarFeed() {
        // parte que coloca o nome e o tipo do usuário embaixo

        var nome = sessionStorage.NOME_USUARIO;
        var tipo = sessionStorage.TIPO_USUARIO;

        usuario.innerHTML = `<h4>${nome}</h4>
                <h5>${tipo}</h5>`


        // parte que decide se irá mostrar opções como add um usuário e entre outros
        if (tipo == 'Administrador') {
            div_links.innerHTML = `<a href="tela_cadastro_lixeira.html">
                        <li>Adicionar lixeira</li>
                    </a>
                    <a href="tela_cadastro_logado.html">
                        <li>Adicionar Usuário</li>
                    </a>
                    <a href="BobIA.html">
                        <li>Área Técnica</li>
                    </a>`
        }


        var idEmpresa = sessionStorage.EMPRESAID;
        fetch(`/lixeira/listar/${idEmpresa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    for (let i = 0; i < resposta.length; i++) {
                        var lixeira = resposta[i];

                        // Criação do elemento principal (div) e definição da classe
                        var cardElement = document.createElement("div");
                        cardElement.className = "card";

                        // Criação dos elementos HTML internos
                        var h3Element = document.createElement("h3");
                        var iconElement = document.createElement("i");
                        var h4RuaElement = document.createElement("h4");
                        var h4NivelElement = document.createElement("h4");
                        var spanNivelElement = document.createElement("span");
                        var spanNumeroElement = document.createElement("span");

                        // Definição do conteúdo e atributos dos elementos
                        h3Element.innerHTML = lixeira.nomeLixeira;

                        iconElement.className = "fa-solid fa-dumpster";
                        iconElement.style.color = "red";

                        h4RuaElement.innerHTML = lixeira.cep;
                        spanNumeroElement.innerHTML = '<b>Número:</b>' + lixeira.numero

                        h4NivelElement.innerHTML = "Nível: ";

                        spanNivelElement.innerHTML = "Alto";
                        spanNivelElement.style.color = "red";

                        // Construção da hierarquia dos elementos
                        h4NivelElement.appendChild(spanNivelElement);

                        cardElement.appendChild(h3Element);
                        cardElement.appendChild(iconElement);
                        cardElement.appendChild(h4RuaElement);
                        cardElement.appendChild(spanNumeroElement);
                        cardElement.appendChild(h4NivelElement);
                        

                        // Adicionando o cardElement ao elemento de destino no DOM (ajuste o seletor conforme necessário)
                        document.getElementById("card_pai").appendChild(cardElement);
                    }

                    finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });
    }

</script>